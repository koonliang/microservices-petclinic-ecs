server.port: 8081
spring:
  application:
    name: customers-service
  config:
    import: optional:configserver:${CONFIG_SERVER_URL:http://localhost:8888/}
  cloud:
    config:
      # Retry configuration - wait for config-server to be available
      fail-fast: false
      retry:
        initial-interval: 3000
        max-attempts: 20
        max-interval: 10000
        multiplier: 1.5
  # HSQLDB data initialization - local config so it works without config-server
  sql:
    init:
      schema-locations: classpath*:db/hsqldb/schema.sql
      data-locations: classpath*:db/hsqldb/data.sql
      mode: always
  jpa:
    defer-datasource-initialization: true
    hibernate:
      ddl-auto: none


---
spring:
  config:
    activate:
      on-profile: docker
    import: optional:configserver:${CONFIG_SERVER_URL:http://config-server:8888}

---
# AWS profile: Require config-server to be available (ECS will restart if not ready)
spring:
  config:
    activate:
      on-profile: aws
    import: configserver:${CONFIG_SERVER_URL:http://config-server.petclinic.local:8888}
  cloud:
    config:
      fail-fast: true
      retry:
        initial-interval: 5000
        max-attempts: 30
        max-interval: 15000
        multiplier: 1.5
